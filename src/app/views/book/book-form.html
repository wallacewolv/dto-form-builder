<h2>{{ pageTitle() }}</h2>

<form [formGroup]="form()" (ngSubmit)="onSubmit()" class="book-form">
  <mat-form-field appearance="outline" class="full-width">
    <mat-label>Título</mat-label>
    <input matInput formControlName="title" />
    @if (form().controls.title.invalid && form().controls.title.touched) {
    <mat-error>O título é obrigatório.</mat-error>
    }
  </mat-form-field>

  <mat-form-field appearance="outline" class="full-width">
    <mat-label>Autor</mat-label>
    <input matInput formControlName="author" />
    @if (form().controls.author.invalid && form().controls.author.touched) {
    <mat-error>O autor é obrigatório.</mat-error>
    }
  </mat-form-field>

  <mat-form-field appearance="outline" class="full-width">
    <mat-label>Preço</mat-label>
    <input matInput type="number" formControlName="price" />
    @if (form().controls.price.invalid && form().controls.price.touched) {
    <mat-error>
      @if (form().controls.price.hasError('required')) { O preço é obrigatório.
      } @if (form().controls.price.hasError('min')) { O preço não pode ser
      negativo. }
    </mat-error>
    }
  </mat-form-field>

  <mat-form-field appearance="outline" class="full-width">
    <mat-label>Data de Publicação</mat-label>
    <input matInput type="date" formControlName="publishedDate" />
  </mat-form-field>

  <mat-slide-toggle formControlName="available">Disponível</mat-slide-toggle>

  <div formArrayName="genres">
    <label>Gêneros</label>
    @for (genreCtrl of genres.controls; track $index) {
    <mat-form-field appearance="outline" class="full-width">
      <input
        matInput
        [formControlName]="$index"
        [placeholder]="'Gênero ' + ($index + 1)"
      />
    </mat-form-field>
    }
    <button mat-button type="button" (click)="addGenre()">
      + Adicionar Gênero
    </button>
  </div>

  <button
    mat-raised-button
    color="primary"
    type="submit"
    [disabled]="form().invalid"
  >
    Salvar Livro
  </button>
</form>
